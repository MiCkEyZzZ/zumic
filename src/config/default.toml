# --------------------------------------------------------------------
# Зумик ДБ — основной конфигурационный файл (значения по умолчанию)
# Этот файл коммитится в репозиторий и содержит значения по умолчанию.
# Переопределяйте в config/<profile>.toml или через переменные
# окружения ZUMIC_*
# --------------------------------------------------------------------

# Персистентность / AOF
aof_path = "./data/dump.aof"                                # путь к AOF (Append Only File)
snapshot_freq = 300                                         # частота снапшотов в секундах

# Пул потоков
thread_pool_size = 8                                        # кол-во потоков для тяжёлых задач

# Сеть
listen_address = "127.0.0.1:6174"                           # Адрес и порт, на которых сервер будет принимать подключения

# Настройки хранилища
storage_type = "memory"                                     # Доступные варианты: "memory"|"persistent"|"cluster"
                                                            # memory — данные только в оперативной памяти (быстро, но временно)
                                                            # persistent — хранение на диске (файлы / WAL / контрольные точки)
                                                            # cluster — распределённый режим (несколько нод)

# Управление соединениями
max_connections = 10000                                     # Максимальное число одновременных клиентских соединений
max_connections_per_ip = 100                                # Максимум соединений с одного IP (защита от DoS / перебора)

# Таймауты (в секундах)
connection_timeout = 300                                    # Сколько секунд соединение может простаивать (idle) до разрыва
read_timeout = 30                                           # Максимальное время ожидания команды от клиента
write_timeout = 10                                          # Максимальное время ожидания записи ответа клиенту

# Буферы
read_buffer_size = 8192                                     # Размер буфера чтения на соединение (в байтах)
                                                            # Увеличение буфера ускоряет bulk-операции, но требует памяти

# Завершение работы сервера
shutdown_timeout = 30                                       # Максимальное время (в секундах), в течение которого сервер будет ждать
                                                            # завершения активных соединений при graceful shutdown

# Логирование (опционально)
log_level = "info"                                          # Уровень логов: trace, debug, info, warn, error
# log_level = "trace"
# log_level = "debug"
# log_level = "warn"
# log_level = "error"

# Настройка производительности (опционально)
# worker_threads = 4                                        # количество worker-потоков (по умолчанию — CPU cores)
# tcp_nodelay = true                                        # отключить Nagle для меньшей задержки
# tcp_keepalive = true                                      # включить TCP keepalive
# so_reuseaddr = true                                       # разрешить reuse addr

# Память (для storage_type = "Memory")
max_memory = "2GB"                                          # лимит памяти
# memory_policy = "allkeys-lru"                             # политика вытеснения

# Настройки персистентности (опции для persistent)
# data_dir = "./data"                                       # папка с данными
# checkpoint_interval = 300                                 # интервал чекпоинтов в секундах
# wal_enabled = true                                        # вкл. журналирование WAL
# compression = "lz4"                                       # сжатие: none | lz4 | gzip

# Кластер (для storage_type = "cluster")
# cluster_enabled = false
# cluster_nodes = ["127.0.0.1:6175", "127.0.0.1:6176"]
# cluster_replica_factor = 1
# cluster_consistency = "eventual"  # strong | eventual

# Мониторинг
# metrics_enabled = true
# metrics_port = 9090
# health_check_port = 8080
# profiling_enabled = false

# Безопасность (TLS и ACL)
# tls_enabled = false
# tls_cert = "server.crt"
# tls_key = "server.key"
# allowed_ips = ["127.0.0.1", "192.168.1.0/24"]

# ------------------------------------------------------------
# ACL / аутентификация
# ------------------------------------------------------------
# Простой общий пароль (пример; лучше хранить в ENV):
# requirepass neutrino
#
# Redis-стиль (пример для справки, НЕвалидный TOML):
# user default on nopass ~* +@all
# user anton on >REPLACE_WITH_SUPERSECRET ~data:* +get +set
#
# Рабочая конфигурация в виде TOML-блоков:
[[users]]
name = "default"
nopass = true
pattern = "*"
roles = ["admin"]

# Можно оставить одного реального юзера, второй убрать
# Если нужен второй — задаём пароль через ENV:
[[users]]
name = "anton"
password_env = "ZUMIC_USER_ANTON_PASSWORD"
pattern = "data:*"
permissions = ["get","set"]
