# Changelog

## [Unreleased] - 0000-00-00

### Добавлено

- **zumic**
  - Пример файла `.env.example` с основными переменными окружения для удобства разработки и запуска проекта.
- **engine**

  - Добавлен асинхронный трейт `AsyncStorage` для плавного перехода к асинхронной версии.
  - Добавлено и полностью реализовано компактирование и снапшоты AOF (Issue **P2**):
    - Фоновый поток компактизации (background compaction thread) с настраиваемым интервалом и порогами.
    - Создание полных снапшотов (full snapshot) — дамп состояния в момент времени.
    - Инкрементальный AOF после снапшота (rotate log files) и логика ротации AOF.
    - Атомарный swap нового компактного файла (temp → prod) для безопасной замены AOF/snapshot файлов.
    - Recovery strategy: восстановление через snapshot + инкрементальный AOF replay, включая корректную обработку неполных/коррумпированных записей в хвосте AOF.
    - Конфигурируемые пороги компактизации (по размеру файла, по количеству записей, по времени).
    - Graceful handling компактификации при shutdown: финальный flush и опциональный финальный снапшот.
    - Метрики для мониторинга: частота компактизации, размеры файлов, время восстановления, количество операций компактизации и т.д.
    - Юнит- и интеграционные тесты для основных сценариев компактизации и восстановления.
  - Новый модуль: `src/engine/compaction.rs`.
  - Расширен модуль: `src/engine/aof.rs` (логика ротации, recovery-интеграция).
  - Интеграция RecoveryManager/CompactionManager в `PersistentStore` (инициализация, trigger\_compaction, create\_snapshot, метрики).

## [v0.4.0] - 2025-09-08

### Добавлено

- **Sharding в Persistent и Cluster Store**
  - Реализован шардированный индекс для распределения данных по N шардов с использованием консистентного хеширования, что устраняет узкие места глобального мьютекса.
  - Каждый шард защищён отдельным `RwLock` для снижения блокировок и повышения параллелизма чтения.
  - Конфигурируемое количество шардов (`num_shards`) для `persistent` и `cluster` профилей.
  - Для операций `mset` и `mget` реализована shard-aware логика для минимизации межшардовых блокировок.
  - Введены пер-шардовые метрики: количество ключей, lock contention, latency операций.
  - Поддержка шардирования добавлена в конфиги:
    - `config/persistent.toml` с секцией `[persistent_store.sharding]`
    - `config/cluster.toml` с секцией `[cluster]`
  - Новый модуль `src/engine/sharding.rs` с реализацией шардирования.
  - Проведены нагрузочные тесты, показывающие улучшенную производительность после внедрения шардинга.
- **Динамическое управление шардированием и ребалансировка слотов**
  - Добавлен `SlotManager` с runtime изменениями для распределения 16384 слотов между шардом с поддержкой миграции и версии карты слотов.
  - Внедрен мониторинг нагрузки по операциям в секунду и по доступу к слотам, учёт "горячих" ключей.
  - Реализован механизм постепенной миграции слотов для плавного ребалансинга без прерывания операций.
  - Добавлена поддержка альтернативного консистентного хеширования в `SlotManager`.
  - Реализован `AdvancedRebalancer` с конфигурируемыми порогами, batch-обработкой миграций и триггерами (дисбаланс, горячие ключи, ручной запуск).
  - В кластерный хранилище интегрирован `SlotManager`, поддерживаются мульти-шардовые операции с учетом кросс-шардовых вызовов и их учётом в метриках.
  - Добавлен фоновый тред для автоматической проверки и запуска ребалансировки.
  - Введены подробные метрики по состоянию кластера, ребалансировкам и здоровью системы с историей и отчётами.
  - Разработаны и покрыты тестами основные сценарии управления слотами и ребалансировки, включая миграции, ограничение нагрузки и эффективность ребаланса.
- **Подключение кластерного хранилища в main.rs**
  - Вместо вывода ошибки при выборе `StorageType::Cluster` теперь создаётся кластер из трёх InMemoryStore шардов.
  - Используется `InClusterStore` с динамическим распределением ключей по слотам.
  - Обеспечена возможность запуска сервера с переключением между разными типами хранилища (`Memory`, `Persistent`, `Cluster`) через конфиг.
  - Позволяет легко тестировать и проверять работу кластерного слоя в режиме реального времени.
- **Новые типы ошибок для SlotManager в системе глобальных ошибок**
  - Ошибки миграции и ребаланса слотов вынесены в отдельный модуль `error/slot_manager.rs`.
  - Определён enum `SlotManagerError` с вариантами для активной миграции, отсутствия миграции, повторной постановки в очередь, ошибками ввода-вывода, невалидными слотами и другими.
  - Реализованы конвертации из стандартных `PoisonError`, строк и других типов в `SlotManagerError`.
  - Позволяет централизованно и типобезопасно обрабатывать ошибки SlotManager на уровне runtime.



### Изменено

- Интеграция шардированного индекса в `PersistentStore` и `ClusterStore`:
  - Индекс разделён на шарды для параллельного доступа.
  - Добавлена логика выбора и доступа к нужному шару по ключу.
  - Внедрено обновление и подсчёт пер-шард метрик (кол-во ключей, операции чтения/записи, блокировки).
  - Обновлено логирование операций в AOF и cluster replication с учётом шардирования.
  - Оптимизированы операции `set`, `get`, `del`, `mset`, `mget` с минимизацией блокировок между шардом.
  - Расширен `PersistentStore` и `ClusterStore` для интеграции с динамическим распределением слотов.
  - Улучшена учётная логика операций с учётом мульти-шардового распределения и кросс-шардовых вызовов.
  - Обновлены конфигурационные файлы для поддержки параметров шардирования и ребалансировки.

### Исправлено

- Исправлен flaky тест `test_sharded_mset_mget` в `persistent.rs`:
  - Обеспечена корректная и стабильная проверка распределения ключей после операций mset/mget.
  - Добавлена проверка на балансировку шардов с порогом неравномерности не выше 2.0.
  - Повышена надёжность и воспроизводимость теста для шардированного persistent store.

## [v0.3.0] - 2025-09-05

### Добавлено

- **Интеграционные тесты TCP-соединений**:
  - новые async-тесты для команд `PING`, `QUIT`, idle timeout и проверки ограничения
    `max_connections_per_ip`.
  - тесты используют `tokio::net::TcpStream` с разделением на `read`/`write` половинки
    через `stream.into_split()`.
  - тесты полностью работают в одном потоке (`current_thread`) и не требуют
    многопоточности.
  - обеспечена проверка корректного ответа сервера и таймаутов без зависаний.

- **Расширенная поддержка типов сообщений в Pub/Sub и интеграция с ZSP**:
  - `PubSub` структура сообщений `(MessagePayload)` теперь поддерживает бинарные
    данные `(Bytes)`, строки `(String)`, JSON-объекты `(Json)`, а также
    произвольные сериализованные объекты с указанием типа `(Serialized)`.
  - протокол **ZSP (Zumic Serialization Protocol)** и его кодеки теперь умеют
    сериализовать и десериализовать все эти `payload-форматы` с сохранением
    `type-safety`.
  - маппинг между слоями **PubSub** и **ZSP** через новые функции в модуле
    `zsp_integration.rs`: корректный `roundtrip` любой комбинации типов, включая
    `legacy` и расширенный формат (бинарный, JSON, сериализованный).
  - введён единый тип сообщений для `wire-level` команд: `PubSubMessage`.
  - поддержаны интеграционные и юнит-тесты на максимально покрытие всех вариантов
    передачи и восстановления сообщений через протокол.

- **Новые ошибки и диагностика:**
  - добавлены детальные типы ошибок `(RecvError, TryRecvError, ZspIntegrationError)`
    для всех операций `pubsub` и протокольных команд, поддерживаются конвертации и
    подробные сообщения.
  - единообразная обработка ошибок на всех этапах — подписка, получение,
    сериализация, взаимодействие с `wire-level`.

- **Внутренние улучшения Pub/Sub**:
  - фильтры сообщений расширены: поддержка фильтрации по размеру, метаданным, типу
    payload, JSON-ключам, паттернам поиска.
  - поддержка локального буфера сообщений для отложенного получения и сложных
    сценариев высокой нагрузки.
  - реализована статистика по подписчику: счётчики полученных, отфильтрованных,
    просроченных, десериализационных ошибок, таймстемпы активности.

- **Массовая подписка на каналы:**
  - новый компонент `MultiSubscriber` — поддержка подписки на множество каналов с
    `round-robin API`.
  - агрегация статистики по всем подписчикам и получение сообщений с любого/всех
    каналов в одном интерфейсе.

- **Команды ZSP PubSub**:
  - реализована сериализация и десериализация `wire-level` команд: `SUBSCRIBE`,
    `UNSUBSCRIBE`, `PUBLISH`, включая сложные payload.
  - поддержан legacy формат и новый расширенный формат для pubsub-команд.

- **Тестирование:**
  - добавлен интеграционный тестовый набор в корневой папке tests/ — покрытие всех
    типов сообщений и команд на `codec/protocol-уровне`.
  - все тесты проходят — гарантии `interoperability` между слоями.

- **Баннер при запуске сервера:**
  - новый модуль `network/banner.rs` с поддержкой двух режимов отображения
    (полный/компактный).
  - отображает версию, режим работы `(debug/release)`, адрес и порт, тип хранилища,
    PID, имя хоста, ОС/архитектуру, количество CPU, объём памяти, git-commit,
    время сборки, ссылку на сайт.
  - автоматический выбор режима (debug → полный, release → компактный) или
    принудительно через переменную окружения `ZUMIC_BANNER=full|compact`.
- запуск с баннером:
  - обновлён `main.rs`: перед стартом TCP-листенера вызывается banner::print_banner(
    ...) с подставленными параметрами.
  - форматированный и цветной вывод при поддержке TTY, с адаптацией по терминалу.
  - порт берётся из конфига, либо по умолчанию `6174`.
- новые цели Makefile:
  - группа `##@ Запуск`: `run, run-full`, `run-compact`, `run-release` для быстрого запуска
    с разными режимами баннера.
  - обновлены названия секций Makefile на русский, добавлено единообразное описание
    целей.
  - разделены секции `##@ Сборка`, `##@ Тест`, `##@ Запуск` и др. для лучшей читаемости.
  - обновлен help вывод с локализированным заголовком.
- **CONTRIBUTING.md:**
  - добавил подробное описание, как можно внести вклад в развитие проекта.

- **Fuzzing инфраструктура для `decode_value`**:
  - добавлен fuzz-таргет `decode_value.rs` в `fuzz/fuzz_targets/`;
  - реализованы проверки для функции `read_value_with_version` со случайными байтами;
  - добавлены специальные тесты для `TAG_COMPRESSED` с корраптед ZSTD-данными;
  - создан скрипт `scripts/run_fuzz.sh` для запуска fuzzing с логированием и сохранением артефактов;
  - инфраструктура проверена на коротком запуске (10 минут) — стабильность и отсутствие падений подтверждена;
  - цель 24-часового фаззинга будет достигнута при длительном запуске.

### Изменено

- полная рефакторизация слоёв взаимодействия `Pub/Sub` и `ZSP`: изоляция кодеков,
  перенос логики маппинга в отдельные модули;
- серьёзно улучшена типобезопасность и расширяемость сообщений — платформа готова
  к добавлению новых форматов payload;
- обновлены/расширены примеры, комментарии и документация для новых структур и
  протокольных команд;
- улучшена логика падения/выхода при ошибках: не бывает зависших тасков,
  гарантировано корректное завершение процессов после тестов;
- изменил название структур данных: `intset`, `listpack`, `smarthash`;
- В .gitignore внес новые файлы, которые должны быть скрыты: `bin`, `client`;
- В `zdb_protocol` была добавлена новая ф-я `load_from_reader` для тестов и для fuzz
  и изменена ф-я `load_from_zdb`;
- **Конфигурация сервера (`config/default.toml`)**:
  - listen_address изменён с `0.0.0.0:6379` на `127.0.0.1:6174` для тестов и разработки.
  - удалён устаревший файл `zumic.conf`, все параметры теперь в `Settings` и
    `default.toml`.
- **Settings (`config/settings.rs`)**:
  - обновлена десериализация и значения по умолчанию для новых параметров TCP:
    `listen_address`, `max_connections_per_ip`, `connection_timeout`, `read_timeout`,
    `write_timeout`.
  - введены опциональные поля с `Option` и безопасными значениями по умолчанию.
  - убрана зависимость от устаревшего конфига `zumic.conf`.

### Исправлено

- решены проблемы с сравнением между `Arc<str>` и `&str` в клиентских и серверных
  API.
- исправлены вызовы макросов (json!) в тестах.
- исправлены ошибки конструирования enum-ов — все типы и функции принимают и
  возвращают правильные аргументы.
- обработана автоматическая очистка и дроп каналов, что позволило избежать
  "зависания" процессов после завершения тестов.
- **изменения в конфиге**:
  - config/default.toml: listen_address изменён с `0.0.0.0:6379` на `0.0.0.0:6174`.
  - config/settings.rs: новые значения по умолчанию для функции default_listen() →
    `127.0.0.1:6174`.
- **рефакторинг сетевых модулей**:
  - network/mod.rs — добавлено описание модуля и упоминание нового подмодуля banner.
  - network/zsp/mod.rs — документация переписана для чёткого описания структуры
    ZSP (frame + protocol).
- **main.rs**:
  - добавлен импорт banner и вызов печати баннера перед запуском листенера.
  - определение отображаемого порта и названия хранилища вынесено в отдельные
    переменные.
  - логика запуска сервера сохранена без изменений.

## [0.2.0] - 2025-07-21

### Добавлено

- **Pub/Sub: Асинхронный API для подписок**
  - в типы `Subscription` и `PatternSubscription` добавлены методы:
    - `async fn recv()` — асинхронное получение следующего сообщения.
    - `fn try_recv()` — немедленное попытка получить сообщение без блокировки
      (`Subscription`).
  - использование внутренних приемников через `receiver()` помечено как устаревшее
    (`deprecated`) с рекомендацией пользоваться новым API.
  - обеспечена полная совместимость с Tokio broadcast каналами.
  - добавлены подробные комментарии и документация для новых методов.
  - проведено плотное покрытие тестами (unit и integration) функционала асинхронного
    получения сообщений.
  - улучшена эргономика и безопасность работы с подписками во внутренней pub/sub
    системе.

- **ZDB (Zumic Dump File) — Продвинутая система версионирования формата дампов**:
  - введена поддержка legacy дампов без явной версии.
  - реализована многоуровневая проверка совместимости версий (`can_read`,
    `can_write`).
  - добавлена детальная диагностика и предупреждения при работе с устаревшими и
    несовместимыми версиями.
  - введены рекомендации по миграции устаревших версий к новым форматам.
  - реализован API для определения версии дампа и проверки совместимости с текущим
    читателем.
  - добавлены обширные unit-тесты, покрывающие все аспекты версии и миграции.

- **GitHub Action**:
  - **CI/CD и шаблоны GitHub**:
    - добавлены шаблоны Issues: `enhancement.yml`, `feature.yml`, `question.yml`,
      `config.yml`.
    - добавлен workflow `release.yml` для автоматизации публикаций релизов.
  - **book**
    - добавлены базовые главы и их описание.

- **Env**
  - **Environment configuration** (`.env`)
    ```dotenv
     ZUMIC_LISTEN_ADDRESS=**
     ZUMIC_MAX_CONNECTIONS=**
     ZUMIC_AOF_PATH=**
     ZUMIC_DSNAPSHOT_PATH=**
     ZUMIC_SNAPSHOT_FREQ=**
     ZUMIC_MAX_MEMORY=**
     ZUMIC_LOG_LEVEL=**
     ZUMIC_PASSWORD=**
     ZUMIC_TLS_CERT=**
     ZUMIC_TLS_KEY=**
     ZUMIC_THREAD_POOL=*
    ```

- **Модули**
  - Добавлены каркас и менеджер плагинов:
    - Файл `modules/api.rs` с трэйтом `Module`.
    - Файл `modules/loader.rs` с динамической загрузкой `.so/.dll`.
    - Файл `modules/wasm.rs` с обёрткой для WASM.
    - Файл `modules/plugin_manager.rs` (раньше `mod.rs`) с `Plugin` и `Manager`.

- **Lua Integration**:
  - Внедрена базовая интеграция Lua-скриптов с использованием библиотеки `mlua`.
  - Добавлен безопасный движок выполнения Lua-скриптов (`LuaEngine`) с
    конфигурируемыми ограничениями по времени, памяти и количеству инструкций.
  - Реализован экспорт типа `Sds` в Lua с методами: `.len()`, `.to_vec()`,
    `.as_str()`, `.substr()`, `.concat()`, `.upper()`, `.lower()`.
  - Обеспечена песочница для скриптов: отключён доступ к OS/файлам/сети,
    предотвращены бесконечные циклы и превышение памяти.
  - Добавлена функция выполнения Lua-скриптов с передачей аргументов и возвратом
    результата.
  - Написан набор автоматизированных тестов, покрывающих работу движка, методы
    `Sds` и обработку ошибок.

### Изменено

  - Внёс улучшения в файл `SECURITY.md`;
  - Вынес файл `pull_request_template.md` в корень .github;
  - Улучшена обработка ошибок с использованием новых ошибок `VersionError` и
    лучшее логирование для диагностики версий.
  - Устранены Clippy предупреждения `uninlined_format_args` во всём pub/sub коде:
    все форматные макросы `format!`, `println!` и `panic!` переведены на
    современный рекомендуемый синтаксис с захватом переменных (`format!("msg{i}")`
    вместо `format!("msg{}", i)`), что позволило успешно пройти сборку и CI/CD.

- **Pub/Sub: Улучшена обработка ошибок**
  - Введены централизованные типы ошибок `RecvError` и `TryRecvError` в модуле `
    src/error/pubsub.rs`.
  - Заменены ранее использовавшиеся generic ошибки
    `tokio::sync::broadcast::error::RecvError` на подробные и семантически
    значимые варианты ошибок.
  - Добавлены варианты ошибок для таких случаев, как закрытый канал, таймаут,
    сериализационные ошибки, отставание приёмника, превышение лимита подписчиков,
    некорректные паттерны и несуществующие каналы.
  - Реализованы преобразования (`From`) из ошибок `broadcast` и `globset` в новые
    типы ошибок.
  - Обновлена сигнатура методов в `Subscription`, `PatternSubscription` и `Broker`
    для использования новых ошибок.
  - Обеспечена лучшая диагностика и типобезопасность при работе с Pub/Sub API.

## [v0.1.0] - 2025-06-06

### Добавлено

- **Основные команды**:
  - реализованы базовые команды для строк: `SET`, `GET`, `DEL`, `EXISTS`, и т.д.
  - реализованы базовые команды для чисел: `INCR`, `DECR`, `INCRBY`, `DECRBY`.
  - реализованы базовые команды для чисел: `INCRBYFLOAT`, `DECRBYFLOAT`, `SETFLOAT`.
  - добавлены тесты для методов: `INCRBYFLOAT`, `DECRBYFLOAT`, `SETFLOAT`.
  - реализованы базовые команды для hash: `HSET`, `HGET`, `HDEL`, `HGETALL`.
  - добавлены тесты для методов: `HSET`, `HGET`, `HDEL`, `HGETALL`.
  - реализованы базовые команды для множеств: `SADD`, `SREM`, `SCARD`, `SMEMBERS`,
    `SISMEMBER`.
  - добавлены тесты для методов: `SADD`, `SREM`, `SCARD`, `SMEMBERS`, `SISMEMBER`.
  - реализованы базовые команды для отсортированных множеств: `ZADD`, `ZSCORE`,
    `ZCARD`, `ZREM`, `ZRANGE`, `ZREVRANGE`.
  - добавлены тесты для методов: `ZADD`, `ZSCORE`, `ZCARD`, `ZREM`, `ZRANGE`,
    `ZREVRANGE`.
  - реализованы базовые команды для списков: `LPUSH`, `RPUSH`, `LPOP`, `RPOP`,
    `LLEN`, `LRANGE`.
  - добавлены тесты для методов: `LPUSH`, `RPUSH`, `LPOP`, `RPOP`, `LLEN`, `LRANGE`.
  - добавлены три новых метода для типа `ArcBytes` следующие: `expect_utf8`,
    `make_mut`, `try_unwrap`.
  - добавлены три новых метода для типа `SmartHash` следующие: `new`, `hset`, `hget`,
    `hdel`.
  - добавлены тесты для типа `SmartHash` его методов: `new`, `hset`, `hget`, `hdel`.
  - добавил дополнительные методы для типа `SkipList`: `contains`, `is_empty`,
    `clear`, `front`, `back`.
  - добавил тесты для всех методов `SkipList`.
  - добавил дополнительные методы для типа `SmartHash`: `keys`, `values`, `entries`,
    `do_downgrade`.

- **Бенчмарки**:

  - добавлены бенчмарки для следующих команд: `basic`, `float`, `int`, `string`,
    `hash`, `set`, `list`, `zset`.

- **GEO-команды**:
  - реализованы команды работы с геоданными: `GEOADD`, `GEOPOS`, `GEODIST`,
    `GEORADIUS`, `GEORADIUSBYMEMBER`.
  - поддержка хранения и извлечения координат с высокой точностью.
  - добавлены тесты на корректность гео-вычислений и сериализации ответов.

- **Поддержка GEO в ZDB и ZSP**:
  - обновлены `zdb` и `zsp` модули для поддержки сериализации массивов
    гео-результатов.
  - обновлён тип `Value` для поддержки GEO-ответов.


- **Кастомные типы**:

  - реализованы кастомные типы, такие как `ArcBytes` и `QuickList`.
  - реализован кастомный типы, такие как `Zip` и `Map` в перечислении `SmartHash`.

- **ZSP (Zumic Serialization Protocol)**:

  - реализованы декодер, encoder, типы для обработки различных типов данных (`Int`,
    `Str`, `List`, `Set`, `Hash`, `ZSet`).
  - поддержка частичного чтения для строк и массивов.
  - добавлен протокол сериализации ZSP с поддержкой кастомных типов и базовых
    операций.

- **ACL**:

  - реализовано управление пользователями, разрешениями и обработка каналов.
  - поддержка загрузки конфигурации пользователей из `zumic.conf` с шаблонами
    пользователей.

- **Аутентификация**:

  - реализован модуль `auth` с поддержкой аутентификации пользователей и ACL.

- **Хеширование паролей**:

  - реализовано хеширование паролей с использованием библиотеки `argon2` в модуле
    `password.rs`.

- **Модуль команд**:

  - реализована базовая структура команд с командами: `SetCommand`, `GetCommand`,
    `DelCommand`, `MsetCommand`.

- **Модуль сети**:

  - начата реализация базового TCP-сервера для сетевого взаимодействия.

- **Типы и утилиты**:

  - определен enum `Value` с типами данных, такими как `Int`, `Str`, `List`, `Set`
    и другие.
  - введены вспомогательные структуры, такие как `ArcBytes`, для эффективной работы
    с байтами.
  - введены вспомогательные структуры, такие как `SkipList`, для эффективной работы
    с отсортированными коллекциями.

- **Тесты**
  - добавлены тесты для методов: `ZADD`, `ZSCORE`, `ZCARD`, `ZREM`, `ZRANGE`,
    `ZREVRANGE`;
  - реализованы базовые команды для списков: `LPUSH`, `RPUSH`, `LPOP`, `RPOP`,
    `LLEN`, `LRANGE`;
  - добавлены тесты для методов: `LPUSH`, `RPUSH`, `LPOP`, `RPOP`, `LLEN`,
    `LRANGE`;
  - добавлены три новых метода для типа `ArcBytes` следующие: `expect_utf8`,
    `make_mut`, `try_unwrap`;
  - добавлены три новых метода для типа `SmartHash` следующие: `new`, `hset`,
    `hget`, `hdel`;
  - добавлены тесты для типа `SmartHash` его методов: `new`, `hset`, `hget`,
    `hdel`;
  - добавил дополнительные методы для типа `SkipList`: `contains`, `is_empty`,
    `clear`, `front`, `back`;
  - добавил тесты для всех методов `SkipList`;
  - добавил дополнительные методы для типа `SmartHash`: `keys`, `values`,
    `entries`, `do_downgrade`;
  - добавил интеграционный тест для `zsp_codec`

- **Инициализация проекта**:
  - изначальная настройка структуры проекта и базовых утилит.

### Изменено

- существенные обновления реализации ZSP для улучшения совместимости с различными
  типами данных, такими как строки, множества, хеши и другие.
- изменена логика ф-ии. Результат улучшена производительность для команды
  `AppendCommand`.
- добавил документацию: `database`, `command`.
- изменил логику ф-ии. `hset`, `hdel` в перечислении `SmartHash`.
- изменил логику ф-ии в zsp/frame/zap_types: `convert_smart_hash`
- изменил логику ф-ии в zsp/protocol/seriazizer: `value_to_frame`
- изменил логику ф-ии в command/zset для всех: `execute` ф-ий.
- изменил логику работы database/skip_list добавил ф-ю: `find_update` для более
  безопасной работы с сырыми указателями в unsave режиме.
- изменил логику работы database/skip_list добавил поле `backward` в структуру
  Node.
- изменил названия методов в `SmartHash` на: `insert`, `get`, `remove`, `get_all`.
- расширен интерфейс `Store` для поддержки операций с геоданными.
- обновлены реализации `MemoryStore`, `PersistentStore`, `ClusterStore` для полной
  поддержки GEO-команд.
- переработан `StorageEngine` с маршрутизацией GEO-команд в соответствующий backend.
- изменена логика сериализации в `zsp` для поддержки вложенных структур гео-ответов
  (списки координат, расстояний и т.п.).


### Исправлено

- исправлены проблемы с совместимостью различных типов данных ZSP при сериализации
  и десериализации.
- исправил добавив реализацию `Drop` для `SkipList`, которая позволит автоматически
  освобождать памяти при уничтожении структуры.
