# «В поисках понятного алгоритма консенсуса»

Декларация

> **Эта страница содержит документ «В поисках понятного алгоритма консенсуса (расширенная версия)». Ссылка на оригинальную статью: [https://raft.github.io/raft.pdf](https://raft.github.io/raft.pdf)**

- В поисках понятного алгоритма консенсуса
- Диего Онгаро и Джон Оустерхут
- Стэнфордский университет

## Аннотация

Raft — это алгоритм консенсуса для управления реплицированным журналом (лога). Он даёт результат, эквивалентный (мульти-)Paxos, и при этом так же эффективен, как Paxos, но его структура отличается от Paxos; это делает Raft более понятным и обеспечивает лучшую основу для построения практических систем.

Для повышения понятности Raft разделяет ключевые элементы консенсуса, такие как выбор лидера, репликация журнала и обеспечение корректности (safety), и обеспечивает более высокий уровень согласованности, чтобы уменьшить количество состояний, которые необходимо учитывать.

Результаты исследования с участием пользователей показывают, что Raft проще для изучения студентами, чем Paxos. Raft также включает новый механизм изменения состава кластера, который использует перекрывающиеся большинства для гарантии корректности.

## Введение

Алгоритмы консенсуса позволяют коллекции машин работать как согласованная группа, которая может выдерживать сбои некоторых своих участников. Благодаря этому они играют ключевую роль в построении надёжных масштабируемых программных систем. Paxos [15, 16] доминировал в обсуждениях алгоритмов консенсуса за последнее десятилетие: большинство реализаций консенсуса основаны на Paxos или вдохновлены им, и Paxos стал основным инструментом, используемым для обучения студентов консенсусу.

К сожалению, Paxos довольно трудно понять, несмотря на многочисленные попытки сделать его более доступным. Более того, его архитектура требует сложных изменений для поддержки практических систем. В результате как разработчики систем, так и студенты испытывают трудности с Paxos.

После того как мы сами столкнулись с трудностями Paxos, мы поставили цель найти новый алгоритм консенсуса, который мог бы обеспечить лучшую основу для построения систем и обучения. Наш подход был необычен тем, что нашей основной целью была понятность: можем ли мы определить алгоритм консенсуса для практических систем и описать его так, чтобы его было значительно легче изучить, чем Paxos? Более того, мы хотели, чтобы алгоритм способствовал развитию интуиций, которые необходимы системным разработчикам. Было важно не только, чтобы алгоритм работал, но и чтобы было очевидно, **почему он работает**.

Результатом этой работы стал алгоритм консенсуса под названием **Raft**. При проектировании Raft мы применяли конкретные методы для повышения понятности, включая декомпозицию (Raft разделяет выбор лидера, репликацию журнала и обеспечение корректности) и сокращение пространства состояний (по сравнению с Paxos, Raft уменьшает степень недетерминированности и способы, которыми серверы могут быть несогласованными друг с другом). Технический отчёт является расширенной версией [32]; дополнительный материал отмечен серой полосой на полях. Опубликовано 20 мая 2014 года.

Исследование с участием 43 студентов из двух университетов показало, что Raft значительно проще для понимания, чем Paxos: после изучения обоих алгоритмов 33 студента смогли лучше ответить на вопросы о Raft, чем на вопросы о Paxos.

Raft во многих отношениях похож на существующие алгоритмы консенсуса (в особенности, на Viewstamped Replication Оки и Лискова [29, 22]), но имеет несколько новых особенностей:

1/. **Сильный лидер**: Raft использует более строгую форму лидерства, чем другие алгоритмы консенсуса. Например, записи в журнале передаются только от лидера к другим серверам. Это упрощает управление реплицированным журналом и делает Raft проще для понимания.

2/. **Выбор лидера**: Raft использует случайные таймеры для выборов лидеров. Это добавляет лишь небольшую сложность к heartbeats, которые уже требуются любому алгоритму консенсуса, при этом конфликты разрешаются просто и быстро.

3/. **Изменение состава кластера**: Механизм Raft для изменения множества серверов в кластере использует новый подход совместного консенсуса, при котором большинства двух различных конфигураций перекрываются во время перехода. Это позволяет кластеру продолжать нормальную работу во время изменения конфигурации.

Мы считаем, что Raft превосходит Paxos и другие алгоритмы консенсуса как для образовательных целей, так и как основу для реализации. Он проще и понятнее других алгоритмов; он описан достаточно полно для удовлетворения потребностей практической системы; имеет несколько реализаций с открытым исходным кодом и используется рядом компаний; его свойства безопасности формально специфицированы и доказаны; а его эффективность сопоставима с другими алгоритмами.

Остальная часть статьи вводит проблему реплицированной машины состояний (Раздел 2), обсуждает сильные и слабые стороны Paxos (Раздел 3), описывает наш общий подход к понятности (Раздел 4), представляет алгоритм консенсуса Raft (Разделы 5–8), оценивает Raft (Раздел 9) и обсуждает связанные работы (Раздел 10).
